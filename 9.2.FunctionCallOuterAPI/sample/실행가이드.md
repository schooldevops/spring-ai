# Function Calling μ™Έλ¶€ API μ—°λ™ μƒν” ν”„λ΅μ νΈ μ‹¤ν–‰ κ°€μ΄λ“

μ΄ κ°€μ΄λ“λ” Function Callingμ„ ν†µν•΄ μ™Έλ¶€ APIλ¥Ό μ—°λ™ν•λ” μƒν” ν”„λ΅μ νΈλ¥Ό μ‹¤ν–‰ν•λ” λ°©λ²•μ„ μ•λ‚΄ν•©λ‹λ‹¤.

## π“‹ μ‚¬μ „ μ¤€λΉ„μ‚¬ν•­

### κΈ°λ³Έ μ¤€λΉ„
- JDK 17 μ΄μƒ
- Gradle μ„¤μΉ (λλ” Gradle Wrapper μ‚¬μ©)

### LLM μ¤€λΉ„μ‚¬ν•­

#### OpenAI μ‚¬μ© μ‹ (κ¶μ¥ - Function Calling μ™„μ „ μ§€μ›)
- OpenAI API Key λ°κΈ‰: https://platform.openai.com/
- Function Callingμ„ μ§€μ›ν•λ” λ¨λΈ μ‚¬μ© (GPT-4, GPT-3.5-turbo λ“±)

#### Ollama μ‚¬μ© μ‹
- Ollama μ„¤μΉ:
  ```bash
  # macOS
  brew install ollama
  
  # Linux
  curl -fsSL https://ollama.ai/install.sh | sh
  ```
- Ollama μ„λ²„ μ‹¤ν–‰:
  ```bash
  ollama serve
  ```
- λ¨λΈ λ‹¤μ΄λ΅λ“:
  ```bash
  ollama pull llama2
  # λλ”
  ollama pull mistral
  ```

> β οΈ **μ£Όμ**: Ollamaμ μΌλ¶€ λ¨λΈμ€ Function Callingμ„ μ™„μ „ν μ§€μ›ν•μ§€ μ•μ„ μ μμµλ‹λ‹¤. OpenAI GPT-4λ‚ GPT-3.5-turboλ¥Ό μ‚¬μ©ν•λ” κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤.

---

## π€ μ‹¤ν–‰ λ°©λ²•

### μ‹λ‚λ¦¬μ¤ 1: Ollama μ‚¬μ© (κΈ°λ³Έ μ„¤μ •)

#### 1. Ollama μ„λ²„ μ‹¤ν–‰

```bash
ollama serve
```

#### 2. ν”„λ΅μ νΈ μ‹¤ν–‰

```bash
cd sample
./gradlew bootRun
```

#### 3. ν…μ¤νΈ

μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‹μ‘λλ©΄ λ‹¤μ μ—”λ“ν¬μΈνΈλ¥Ό ν…μ¤νΈν•  μ μμµλ‹λ‹¤:

```bash
# μƒνƒ ν™•μΈ
curl http://localhost:9000/api/function-call/test

# λ‚ μ”¨ μ΅°ν ν•¨μ ν…μ¤νΈ
curl -X POST http://localhost:9000/api/function-call/weather \
  -H "Content-Type: application/json" \
  -d '{"message": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ¤"}'

# μ£Όλ¬Έ μƒνƒ μ΅°ν ν•¨μ ν…μ¤νΈ
curl -X POST http://localhost:9000/api/function-call/order \
  -H "Content-Type: application/json" \
  -d '{"message": "ORD-001 μ£Όλ¬Έ μƒνƒ μ•λ ¤μ¤"}'

# μ—¬λ¬ ν•¨μλ¥Ό ν•¨κ» μ‚¬μ©
curl -X POST http://localhost:9000/api/function-call/smart \
  -H "Content-Type: application/json" \
  -d '{"message": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ£Όκ³  ORD-001 μ£Όλ¬Έ μƒνƒλ„ ν™•μΈν•΄μ¤"}'
```

### μ‹λ‚λ¦¬μ¤ 2: OpenAI μ‚¬μ© (Function Calling μ™„μ „ μ§€μ›)

#### 1. ν™κ²½ λ³€μ μ„¤μ •

```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

#### 2. build.gradle.kts μμ •

```kotlin
dependencies {
    // OpenAI μμ΅΄μ„± μ£Όμ„ ν•΄μ 
    implementation("org.springframework.ai:spring-ai-openai-spring-boot-starter:1.0.0-M6")
    
    // Ollama μμ΅΄μ„± μ£Όμ„ μ²λ¦¬
    // implementation("org.springframework.ai:spring-ai-ollama-spring-boot-starter:1.0.0-M6")
}
```

#### 3. application.yml μμ •

```yaml
spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      chat:
        options:
          model: gpt-4          # λλ” gpt-3.5-turbo
          temperature: 0.7
          max-tokens: 1000
```

#### 4. ν”„λ΅μ νΈ μ¬λΉλ“ λ° μ‹¤ν–‰

```bash
./gradlew clean build
./gradlew bootRun
```

---

## π§ API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ

### 1. μƒνƒ ν™•μΈ

#### GET /api/function-call/test

```bash
curl http://localhost:9000/api/function-call/test
```

**μμƒ μ‘λ‹µ:**
```json
{
  "status": "OK",
  "message": "Function Calling with External API is running",
  "endpoints": "..."
}
```

### 2. λ‚ μ”¨ μ΅°ν ν•¨μ ν…μ¤νΈ

#### POST /api/function-call/weather

```bash
curl -X POST http://localhost:9000/api/function-call/weather \
  -H "Content-Type: application/json" \
  -d '{"message": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ¤"}'
```

**μμƒ μ‘λ‹µ:**
```json
{
  "userMessage": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ¤",
  "aiResponse": "μ„μΈμ ν„μ¬ λ‚ μ”¨λ” μ¨λ„ 15λ„, λ§‘μ, μµλ„ 60%μ…λ‹λ‹¤.",
  "functionUsed": "getWeatherFunction",
  "supportedLocations": ["μ„μΈ", "λ¶€μ‚°", "μ μ£Ό", ...]
}
```

**λ‹¤λ¥Έ μμ :**
```bash
# λ¶€μ‚° λ‚ μ”¨
curl -X POST http://localhost:9000/api/function-call/weather \
  -H "Content-Type: application/json" \
  -d '{"message": "λ¶€μ‚° λ‚ μ”¨λ”?"}'

# μ μ£Ό λ‚ μ”¨
curl -X POST http://localhost:9000/api/function-call/weather \
  -H "Content-Type: application/json" \
  -d '{"message": "μ μ£Όλ„ λ‚ μ”¨ μ•λ ¤μ¤"}'
```

#### GET /api/function-call/weather/locations

μ§€μ›ν•λ” λ„μ‹ λ©λ΅ μ΅°ν:

```bash
curl http://localhost:9000/api/function-call/weather/locations
```

**μμƒ μ‘λ‹µ:**
```json
{
  "supportedLocations": ["μ„μΈ", "λ¶€μ‚°", "μ μ£Ό", "λ€κµ¬", "μΈμ²", "κ΄‘μ£Ό", "λ€μ „", "μμ›"],
  "message": "μ΄ λ„μ‹λ“¤μ λ‚ μ”¨λ¥Ό μ΅°νν•  μ μμµλ‹λ‹¤"
}
```

### 3. μ£Όλ¬Έ μƒνƒ μ΅°ν ν•¨μ ν…μ¤νΈ

#### POST /api/function-call/order

```bash
curl -X POST http://localhost:9000/api/function-call/order \
  -H "Content-Type: application/json" \
  -d '{"message": "ORD-001 μ£Όλ¬Έ μƒνƒ μ•λ ¤μ¤"}'
```

**μμƒ μ‘λ‹µ:**
```json
{
  "userMessage": "ORD-001 μ£Όλ¬Έ μƒνƒ μ•λ ¤μ¤",
  "aiResponse": "ORD-001 μ£Όλ¬Έμ μƒνƒλ” λ°°μ†΅μ¤‘μ…λ‹λ‹¤. μ£Όλ¬Έ μƒν’: λ…ΈνΈλ¶, λ§μ°μ¤. μ΄ μ£Όλ¬Έ κΈμ•΅: 1,500,000μ›μ…λ‹λ‹¤.",
  "functionUsed": "getOrderStatusFunction"
}
```

**λ‹¤λ¥Έ μμ :**
```bash
# λ‹¤λ¥Έ μ£Όλ¬Έ μ΅°ν
curl -X POST http://localhost:9000/api/function-call/order \
  -H "Content-Type: application/json" \
  -d '{"message": "ORD-002 μ£Όλ¬Έ ν™•μΈ"}'

# μ΅΄μ¬ν•μ§€ μ•λ” μ£Όλ¬Έ
curl -X POST http://localhost:9000/api/function-call/order \
  -H "Content-Type: application/json" \
  -d '{"message": "ORD-999 μ£Όλ¬Έ μƒνƒ μ•λ ¤μ¤"}'
```

### 4. μ—¬λ¬ ν•¨μλ¥Ό ν•¨κ» μ‚¬μ© (μ¤λ§νΈ νΈμ¶)

#### POST /api/function-call/smart

LLMμ΄ μƒν™©μ— λ§κ² μ μ ν• ν•¨μλ¥Ό μ„ νƒν•μ—¬ νΈμ¶ν•©λ‹λ‹¤.

```bash
curl -X POST http://localhost:9000/api/function-call/smart \
  -H "Content-Type: application/json" \
  -d '{"message": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ£Όκ³  ORD-001 μ£Όλ¬Έ μƒνƒλ„ ν™•μΈν•΄μ¤"}'
```

**μμƒ μ‘λ‹µ:**
```json
{
  "userMessage": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ£Όκ³  ORD-001 μ£Όλ¬Έ μƒνƒλ„ ν™•μΈν•΄μ¤",
  "aiResponse": "μ„μΈμ ν„μ¬ λ‚ μ”¨λ” μ¨λ„ 15λ„, λ§‘μ, μµλ„ 60%μ…λ‹λ‹¤. ORD-001 μ£Όλ¬Έμ μƒνƒλ” λ°°μ†΅μ¤‘μ…λ‹λ‹¤...",
  "functionsAvailable": ["getWeatherFunction", "getOrderStatusFunction"]
}
```

**λ‹¤λ¥Έ μμ :**
```bash
# λ‚ μ”¨λ§ μ΅°ν
curl -X POST http://localhost:9000/api/function-call/smart \
  -H "Content-Type: application/json" \
  -d '{"message": "λ¶€μ‚° λ‚ μ”¨λ”?"}'

# μ£Όλ¬Έλ§ μ΅°ν
curl -X POST http://localhost:9000/api/function-call/smart \
  -H "Content-Type: application/json" \
  -d '{"message": "ORD-003 μ£Όλ¬Έ μƒνƒλ”?"}'
```

### 5. ν•¨μ μ—†μ΄ μΌλ° νΈμ¶ (λΉ„κµμ©)

#### POST /api/function-call/normal

Function Calling μ—†μ΄ μΌλ°μ μΈ LLM νΈμ¶μ„ μν–‰ν•©λ‹λ‹¤.

```bash
curl -X POST http://localhost:9000/api/function-call/normal \
  -H "Content-Type: application/json" \
  -d '{"message": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ¤"}'
```

μ΄ κ²½μ° LLMμ€ ν•¨μλ¥Ό νΈμ¶ν•μ§€ μ•κ³  μ§μ ‘ μ‘λ‹µμ„ μ‹λ„ν•κ±°λ‚, μ •ν™•ν•μ§€ μ•μ€ λ‹µλ³€μ„ ν•  μ μμµλ‹λ‹¤.

---

## π“ Postman Collection

Postmanμ„ μ‚¬μ©ν•λ” κ²½μ°:

### Request 1: μƒνƒ ν™•μΈ
- Method: GET
- URL: `http://localhost:9000/api/function-call/test`

### Request 2: λ‚ μ”¨ μ΅°ν
- Method: POST
- URL: `http://localhost:9000/api/function-call/weather`
- Body (JSON):
```json
{
  "message": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ¤"
}
```

### Request 3: μ£Όλ¬Έ μƒνƒ μ΅°ν
- Method: POST
- URL: `http://localhost:9000/api/function-call/order`
- Body (JSON):
```json
{
  "message": "ORD-001 μ£Όλ¬Έ μƒνƒ μ•λ ¤μ¤"
}
```

### Request 4: μ¤λ§νΈ νΈμ¶
- Method: POST
- URL: `http://localhost:9000/api/function-call/smart`
- Body (JSON):
```json
{
  "message": "μ„μΈ λ‚ μ”¨ μ•λ ¤μ£Όκ³  ORD-001 μ£Όλ¬Έ μƒνƒλ„ ν™•μΈν•΄μ¤"
}
```

---

## π” ν™•μΈ μ‚¬ν•­

### Ollama ν™•μΈ

```bash
# Ollama μ„λ²„ μ‹¤ν–‰ ν™•μΈ
curl http://localhost:11434/api/tags

# λ‹¤μ΄λ΅λ“λ λ¨λΈ ν™•μΈ
ollama list

# λ¨λΈ ν…μ¤νΈ
ollama run llama2 "μ•λ…•ν•μ„Έμ”"
```

### OpenAI ν™•μΈ

```bash
# ν™κ²½ λ³€μ ν™•μΈ
echo $OPENAI_API_KEY

# API ν…μ¤νΈ
curl http://localhost:9000/api/function-call/test
```

---

## β λ¬Έμ  ν•΄κ²°

### λ¬Έμ  1: ν•¨μκ°€ νΈμ¶λμ§€ μ•μ

**μ¦μƒ**: LLMμ΄ ν•¨μλ¥Ό νΈμ¶ν•μ§€ μ•κ³  μ§μ ‘ μ‘λ‹µν•¨

**μ›μΈ**:
- LLM λ¨λΈμ΄ Function Callingμ„ μ§€μ›ν•μ§€ μ•μ (μΌλ¶€ Ollama λ¨λΈ)
- ν•¨μ μ„¤λ…μ΄ λ¶λ…ν™•ν•¨
- μ‚¬μ©μ μ”μ²­μ΄ λ¨νΈν•¨

**ν•΄κ²°μ±…**:
- OpenAI GPT-4 λλ” GPT-3.5-turbo μ‚¬μ© (Function Calling μ™„μ „ μ§€μ›)
- ν•¨μ μ„¤λ…μ„ λ” λ…ν™•ν•κ² μ‘μ„±
- μ‚¬μ©μ μ”μ²­μ„ λ” κµ¬μ²΄μ μΌλ΅ μ‘μ„±

### λ¬Έμ  2: Ollama μ—°κ²° μ‹¤ν¨

**μ¦μƒ**:
```
Connection refused: localhost:11434
```

**ν•΄κ²°μ±…**:
```bash
# Ollama μ„λ²„ μ‹μ‘
ollama serve

# μ„λ²„ μƒνƒ ν™•μΈ
curl http://localhost:11434/api/tags
```

### λ¬Έμ  3: OpenAI API Key μ¤λ¥

**μ¦μƒ**:
```
Invalid API Key
```

**ν•΄κ²°μ±…**:
```bash
# ν™κ²½ λ³€μ ν™•μΈ
echo $OPENAI_API_KEY

# μ¬λ°”λ¥Έ ν‚¤ μ„¤μ •
export OPENAI_API_KEY="sk-..."
```

### λ¬Έμ  4: ν•¨μ νλΌλ―Έν„° λ§¤μΉ­ μ‹¤ν¨

**μ¦μƒ**: ν•¨μκ°€ νΈμ¶λμ§€λ§ νλΌλ―Έν„°κ°€ μλ»λ¨

**ν•΄κ²°μ±…**:
- ν•¨μ μ„¤λ…μ„ λ” λ…ν™•ν•κ² μ‘μ„±
- μ‚¬μ©μ μ”μ²­μ„ λ” κµ¬μ΅°ν™”λ ν•μ‹μΌλ΅ μ‘μ„±
- λ΅κΉ…μ„ ν†µν•΄ λ””λ²„κΉ…

---

## β… μ²΄ν¬λ¦¬μ¤νΈ

μ‹¤ν–‰ μ „ ν™•μΈ:

### κΈ°λ³Έ
- [ ] JDK 17 μ΄μƒ μ„¤μΉλ¨
- [ ] ν”„λ΅μ νΈ λΉλ“ μ„±κ³µ (`./gradlew build`)
- [ ] μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰ μ„±κ³µ

### Ollama μ‚¬μ© μ‹
- [ ] Ollama μ„¤μΉλ¨
- [ ] Ollama μ„λ²„ μ‹¤ν–‰ μ¤‘ (`ollama serve`)
- [ ] λ¨λΈ λ‹¤μ΄λ΅λ“λ¨ (`ollama pull llama2`)
- [ ] Ollama API μ—”λ“ν¬μΈνΈ μ‘λ‹µ ν™•μΈ

### OpenAI μ‚¬μ© μ‹
- [ ] OpenAI API Key λ°κΈ‰λ¨
- [ ] ν™κ²½ λ³€μ μ„¤μ •λ¨ (`export OPENAI_API_KEY`)
- [ ] Function Calling μ§€μ› λ¨λΈ μ‚¬μ© (GPT-4, GPT-3.5-turbo)
- [ ] API μ—”λ“ν¬μΈνΈ μ‘λ‹µ ν™•μΈ

---

## π“ ν•™μµ μ‹λ‚λ¦¬μ¤

### λ‹¨κ³„ 1: λ‚ μ”¨ μ΅°ν ν•¨μ μ΄ν•΄
1. `/api/function-call/weather` μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
2. ν•¨μκ°€ νΈμ¶λλ” κ³Όμ • κ΄€μ°°
3. μ‘λ‹µ ν™•μΈ

### λ‹¨κ³„ 2: μ£Όλ¬Έ μƒνƒ μ΅°ν ν•¨μ μ΄ν•΄
1. `/api/function-call/order` μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
2. ν•¨μκ°€ νΈμ¶λλ” κ³Όμ • κ΄€μ°°
3. μ‘λ‹µ ν™•μΈ

### λ‹¨κ³„ 3: μ—¬λ¬ ν•¨μ ν•¨κ» μ‚¬μ©
1. `/api/function-call/smart` μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
2. LLMμ΄ μ μ ν• ν•¨μλ¥Ό μ„ νƒν•λ” κ³Όμ • κ΄€μ°°
3. μ—¬λ¬ ν•¨μλ¥Ό ν•¨κ» μ‚¬μ©ν•λ” κ²½μ° ν…μ¤νΈ

### λ‹¨κ³„ 4: μ½”λ“ λ¶„μ„
1. `FunctionConfiguration.kt` ν™•μΈ - μ™Έλ¶€ API ν•¨μ μ •μ λ°©λ²•
2. `MockWeatherService.kt`, `MockOrderService.kt` ν™•μΈ - Mock μ„λΉ„μ¤ κµ¬ν„
3. `FunctionCallService.kt` ν™•μΈ - ν•¨μ μ‚¬μ© λ°©λ²•
4. `FunctionCallController.kt` ν™•μΈ - API μ—”λ“ν¬μΈνΈ κµ¬ν„

---

## π“ λ‹¤μ λ‹¨κ³„

μ΄ μƒν” ν”„λ΅μ νΈλ¥Ό μ„±κ³µμ μΌλ΅ μ‹¤ν–‰ν–λ‹¤λ©΄:

1. β… μ™Έλ¶€ API μ—°λ™μ„ Function CallingμΌλ΅ κµ¬ν„ν•λ” λ°©λ²•μ„ μ΄ν•΄ν–μµλ‹λ‹¤
2. β… Mock μ„λΉ„μ¤λ¥Ό ν™μ©ν•μ—¬ μ™Έλ¶€ APIλ¥Ό ν…μ¤νΈν•λ” λ°©λ²•μ„ λ°°μ› μµλ‹λ‹¤
3. β… μ—¬λ¬ ν•¨μλ¥Ό ν•¨κ» μ‚¬μ©ν•μ—¬ λ³µμ΅ν• μ”μ²­μ„ μ²λ¦¬ν•λ” λ°©λ²•μ„ μ΄ν•΄ν–μµλ‹λ‹¤
4. β… λ‹¤μ μ¥μΌλ΅ μ§„ν–‰ν•  μ¤€λΉ„κ°€ λμ—μµλ‹λ‹¤!

**λ‹¤μ ν•™μµ**: [10μ¥: λ©€ν‹°λ¨λ‹¬ (Multi-modality)](../../README.md#10μ¥-λ©€ν‹°λ¨λ‹¬-multi-modality)

---

## π’΅ μ¶”κ°€ ν•™μµ μλ£

- [Spring AI Function Calling κ³µμ‹ λ¬Έμ„](https://docs.spring.io/spring-ai/reference/api/function-calling.html)
- [OpenAI Function Calling κ°€μ΄λ“](https://platform.openai.com/docs/guides/function-calling)
- [Spring RestTemplate κ°€μ΄λ“](https://docs.spring.io/spring-framework/reference/integration/rest-clients.html)

