# Function Calling ê¸°ë³¸ ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” Function Callingì˜ ê¸°ë³¸ ê°œë…ì„ í•™ìŠµí•˜ëŠ” ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### ê¸°ë³¸ ì¤€ë¹„
- JDK 17 ì´ìƒ
- Gradle ì„¤ì¹˜ (ë˜ëŠ” Gradle Wrapper ì‚¬ìš©)

### LLM ì¤€ë¹„ì‚¬í•­

#### OpenAI ì‚¬ìš© ì‹œ
- OpenAI API Key ë°œê¸‰: https://platform.openai.com/
- Function Callingì„ ì§€ì›í•˜ëŠ” ëª¨ë¸ ì‚¬ìš© (GPT-4, GPT-3.5-turbo ë“±)

#### Ollama ì‚¬ìš© ì‹œ (ê¶Œì¥ - ë¬´ë£Œ)
- Ollama ì„¤ì¹˜:
  ```bash
  # macOS
  brew install ollama
  
  # Linux
  curl -fsSL https://ollama.ai/install.sh | sh
  ```
- Ollama ì„œë²„ ì‹¤í–‰:
  ```bash
  ollama serve
  ```
- ëª¨ë¸ ë‹¤ìš´ë¡œë“œ:
  ```bash
  ollama pull llama2
  # ë˜ëŠ”
  ollama pull mistral
  ```

> âš ï¸ **ì£¼ì˜**: Ollamaì˜ ì¼ë¶€ ëª¨ë¸ì€ Function Callingì„ ì™„ì „íˆ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. OpenAI GPT-4ë‚˜ GPT-3.5-turboë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ì‹œë‚˜ë¦¬ì˜¤ 1: Ollama ì‚¬ìš© (ê¸°ë³¸ ì„¤ì •)

#### 1. Ollama ì„œë²„ ì‹¤í–‰

```bash
ollama serve
```

#### 2. í”„ë¡œì íŠ¸ ì‹¤í–‰

```bash
cd sample
./gradlew bootRun
```

#### 3. í…ŒìŠ¤íŠ¸

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ë©´ ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
# ìƒíƒœ í™•ì¸
curl http://localhost:8080/api/function-call/test

# ê³„ì‚°ê¸° í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8080/api/function-call/calculator \
  -H "Content-Type: application/json" \
  -d '{"message": "10ê³¼ 5ë¥¼ ë”í•´ì¤˜"}'

# ì‹œê°„ ì¡°íšŒ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8080/api/function-call/time \
  -H "Content-Type: application/json" \
  -d '{"message": "í˜„ì¬ ì‹œê°„ ì•Œë ¤ì¤˜"}'

# ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ í•¨ê»˜ ì‚¬ìš©
curl -X POST http://localhost:8080/api/function-call/smart \
  -H "Content-Type: application/json" \
  -d '{"message": "10 ë”í•˜ê¸° 5ëŠ” ì–¼ë§ˆì•¼?"}'
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: OpenAI ì‚¬ìš© (Function Calling ì™„ì „ ì§€ì›)

#### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

#### 2. build.gradle.kts ìˆ˜ì •

```kotlin
dependencies {
    // OpenAI ì˜ì¡´ì„± ì£¼ì„ í•´ì œ
    implementation("org.springframework.ai:spring-ai-openai-spring-boot-starter:1.0.0-M6")
    
    // Ollama ì˜ì¡´ì„± ì£¼ì„ ì²˜ë¦¬
    // implementation("org.springframework.ai:spring-ai-ollama-spring-boot-starter:1.0.0-M6")
}
```

#### 3. application.yml ìˆ˜ì •

```yaml
spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      chat:
        options:
          model: gpt-4          # ë˜ëŠ” gpt-3.5-turbo
          temperature: 0.7
          max-tokens: 1000
```

#### 4. í”„ë¡œì íŠ¸ ì¬ë¹Œë“œ ë° ì‹¤í–‰

```bash
./gradlew clean build
./gradlew bootRun
```

---

## ğŸ§ª API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸

### 1. ìƒíƒœ í™•ì¸

#### GET /api/function-call/test

```bash
curl http://localhost:8080/api/function-call/test
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "status": "OK",
  "message": "Function Calling API is running",
  "endpoints": "..."
}
```

### 2. ê³„ì‚°ê¸° í•¨ìˆ˜ í…ŒìŠ¤íŠ¸

#### POST /api/function-call/calculator

```bash
curl -X POST http://localhost:8080/api/function-call/calculator \
  -H "Content-Type: application/json" \
  -d '{"message": "10ê³¼ 5ë¥¼ ë”í•´ì¤˜"}'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "userMessage": "10ê³¼ 5ë¥¼ ë”í•´ì¤˜",
  "aiResponse": "10ê³¼ 5ë¥¼ ë”í•˜ë©´ 15ì…ë‹ˆë‹¤.",
  "functionUsed": "calculator"
}
```

**ë‹¤ë¥¸ ì˜ˆì œ:**
```bash
# ëº„ì…ˆ
curl -X POST http://localhost:8080/api/function-call/calculator \
  -H "Content-Type: application/json" \
  -d '{"message": "20ì—ì„œ 7ì„ ë¹¼ì¤˜"}'

# ê³±ì…ˆ
curl -X POST http://localhost:8080/api/function-call/calculator \
  -H "Content-Type: application/json" \
  -d '{"message": "6ê³¼ 8ì„ ê³±í•´ì¤˜"}'

# ë‚˜ëˆ—ì…ˆ
curl -X POST http://localhost:8080/api/function-call/calculator \
  -H "Content-Type: application/json" \
  -d '{"message": "15ë¥¼ 3ìœ¼ë¡œ ë‚˜ëˆ ì¤˜"}'
```

### 3. ì‹œê°„ ì¡°íšŒ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸

#### POST /api/function-call/time

```bash
curl -X POST http://localhost:8080/api/function-call/time \
  -H "Content-Type: application/json" \
  -d '{"message": "í˜„ì¬ ì‹œê°„ ì•Œë ¤ì¤˜"}'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "userMessage": "í˜„ì¬ ì‹œê°„ ì•Œë ¤ì¤˜",
  "aiResponse": "í˜„ì¬ ì‹œê°„ì€ 2024-01-15 14:30:45ì…ë‹ˆë‹¤.",
  "functionUsed": "getCurrentTime"
}
```

**ë‹¤ë¥¸ ì˜ˆì œ:**
```bash
# íŠ¹ì • ì‹œê°„ëŒ€ ìš”ì²­
curl -X POST http://localhost:8080/api/function-call/time \
  -H "Content-Type: application/json" \
  -d '{"message": "ì„œìš¸ ì‹œê°„ìœ¼ë¡œ í˜„ì¬ ì‹œê°„ ì•Œë ¤ì¤˜"}'
```

### 4. ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ í•¨ê»˜ ì‚¬ìš© (ìŠ¤ë§ˆíŠ¸ í˜¸ì¶œ)

#### POST /api/function-call/smart

LLMì´ ìƒí™©ì— ë§ê²Œ ì ì ˆí•œ í•¨ìˆ˜ë¥¼ ì„ íƒí•˜ì—¬ í˜¸ì¶œí•©ë‹ˆë‹¤.

```bash
curl -X POST http://localhost:8080/api/function-call/smart \
  -H "Content-Type: application/json" \
  -d '{"message": "10 ë”í•˜ê¸° 5ëŠ”?"}'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "userMessage": "10 ë”í•˜ê¸° 5ëŠ”?",
  "aiResponse": "10 ë”í•˜ê¸° 5ëŠ” 15ì…ë‹ˆë‹¤.",
  "functionsAvailable": ["calculator", "getCurrentTime"]
}
```

**ë‹¤ë¥¸ ì˜ˆì œ:**
```bash
# ê³„ì‚°ê³¼ ì‹œê°„ ì¡°íšŒë¥¼ í•¨ê»˜
curl -X POST http://localhost:8080/api/function-call/smart \
  -H "Content-Type: application/json" \
  -d '{"message": "10ê³¼ 5ë¥¼ ë”í•˜ê³  í˜„ì¬ ì‹œê°„ë„ ì•Œë ¤ì¤˜"}'
```

### 5. í•¨ìˆ˜ ì—†ì´ ì¼ë°˜ í˜¸ì¶œ (ë¹„êµìš©)

#### POST /api/function-call/normal

Function Calling ì—†ì´ ì¼ë°˜ì ì¸ LLM í˜¸ì¶œì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

```bash
curl -X POST http://localhost:8080/api/function-call/normal \
  -H "Content-Type: application/json" \
  -d '{"message": "10ê³¼ 5ë¥¼ ë”í•´ì¤˜"}'
```

ì´ ê²½ìš° LLMì€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³  ì§ì ‘ ê³„ì‚°ì„ ì‹œë„í•˜ê±°ë‚˜, ì •í™•í•˜ì§€ ì•Šì€ ë‹µë³€ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“Š Postman Collection

Postmanì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

### Request 1: ìƒíƒœ í™•ì¸
- Method: GET
- URL: `http://localhost:8080/api/function-call/test`

### Request 2: ê³„ì‚°ê¸° í•¨ìˆ˜
- Method: POST
- URL: `http://localhost:8080/api/function-call/calculator`
- Body (JSON):
```json
{
  "message": "10ê³¼ 5ë¥¼ ë”í•´ì¤˜"
}
```

### Request 3: ì‹œê°„ ì¡°íšŒ í•¨ìˆ˜
- Method: POST
- URL: `http://localhost:8080/api/function-call/time`
- Body (JSON):
```json
{
  "message": "í˜„ì¬ ì‹œê°„ ì•Œë ¤ì¤˜"
}
```

### Request 4: ìŠ¤ë§ˆíŠ¸ í˜¸ì¶œ
- Method: POST
- URL: `http://localhost:8080/api/function-call/smart`
- Body (JSON):
```json
{
  "message": "10 ë”í•˜ê¸° 5ëŠ”?"
}
```

---

## ğŸ” í™•ì¸ ì‚¬í•­

### Ollama í™•ì¸

```bash
# Ollama ì„œë²„ ì‹¤í–‰ í™•ì¸
curl http://localhost:11434/api/tags

# ë‹¤ìš´ë¡œë“œëœ ëª¨ë¸ í™•ì¸
ollama list

# ëª¨ë¸ í…ŒìŠ¤íŠ¸
ollama run llama2 "ì•ˆë…•í•˜ì„¸ìš”"
```

### OpenAI í™•ì¸

```bash
# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
echo $OPENAI_API_KEY

# API í…ŒìŠ¤íŠ¸
curl http://localhost:8080/api/function-call/test
```

---

## âŒ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: LLMì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³  ì§ì ‘ ì‘ë‹µí•¨

**ì›ì¸**:
- LLM ëª¨ë¸ì´ Function Callingì„ ì§€ì›í•˜ì§€ ì•ŠìŒ (ì¼ë¶€ Ollama ëª¨ë¸)
- í•¨ìˆ˜ ì„¤ëª…ì´ ë¶ˆëª…í™•í•¨
- ì‚¬ìš©ì ìš”ì²­ì´ ëª¨í˜¸í•¨

**í•´ê²°ì±…**:
- OpenAI GPT-4 ë˜ëŠ” GPT-3.5-turbo ì‚¬ìš© (Function Calling ì™„ì „ ì§€ì›)
- í•¨ìˆ˜ ì„¤ëª…ì„ ë” ëª…í™•í•˜ê²Œ ì‘ì„±
- ì‚¬ìš©ì ìš”ì²­ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±

### ë¬¸ì œ 2: Ollama ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ**:
```
Connection refused: localhost:11434
```

**í•´ê²°ì±…**:
```bash
# Ollama ì„œë²„ ì‹œì‘
ollama serve

# ì„œë²„ ìƒíƒœ í™•ì¸
curl http://localhost:11434/api/tags
```

### ë¬¸ì œ 3: OpenAI API Key ì˜¤ë¥˜

**ì¦ìƒ**:
```
Invalid API Key
```

**í•´ê²°ì±…**:
```bash
# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
echo $OPENAI_API_KEY

# ì˜¬ë°”ë¥¸ í‚¤ ì„¤ì •
export OPENAI_API_KEY="sk-..."
```

### ë¬¸ì œ 4: í•¨ìˆ˜ íŒŒë¼ë¯¸í„° ë§¤ì¹­ ì‹¤íŒ¨

**ì¦ìƒ**: í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì§€ë§Œ íŒŒë¼ë¯¸í„°ê°€ ì˜ëª»ë¨

**í•´ê²°ì±…**:
- í•¨ìˆ˜ ì„¤ëª…ì„ ë” ëª…í™•í•˜ê²Œ ì‘ì„±
- ì‚¬ìš©ì ìš”ì²­ì„ ë” êµ¬ì¡°í™”ëœ í˜•ì‹ìœ¼ë¡œ ì‘ì„±
- ë¡œê¹…ì„ í†µí•´ ë””ë²„ê¹…

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‹¤í–‰ ì „ í™•ì¸:

### ê¸°ë³¸
- [ ] JDK 17 ì´ìƒ ì„¤ì¹˜ë¨
- [ ] í”„ë¡œì íŠ¸ ë¹Œë“œ ì„±ê³µ (`./gradlew build`)
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì„±ê³µ

### Ollama ì‚¬ìš© ì‹œ
- [ ] Ollama ì„¤ì¹˜ë¨
- [ ] Ollama ì„œë²„ ì‹¤í–‰ ì¤‘ (`ollama serve`)
- [ ] ëª¨ë¸ ë‹¤ìš´ë¡œë“œë¨ (`ollama pull llama2`)
- [ ] Ollama API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

### OpenAI ì‚¬ìš© ì‹œ
- [ ] OpenAI API Key ë°œê¸‰ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ë¨ (`export OPENAI_API_KEY`)
- [ ] Function Calling ì§€ì› ëª¨ë¸ ì‚¬ìš© (GPT-4, GPT-3.5-turbo)
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

---

## ğŸ“ í•™ìŠµ ì‹œë‚˜ë¦¬ì˜¤

### ë‹¨ê³„ 1: ê¸°ë³¸ í•¨ìˆ˜ í˜¸ì¶œ ì´í•´
1. `/api/function-call/calculator` ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
2. í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ê³¼ì • ê´€ì°°
3. ì‘ë‹µ í™•ì¸

### ë‹¨ê³„ 2: ì—¬ëŸ¬ í•¨ìˆ˜ ì‚¬ìš©
1. `/api/function-call/smart` ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
2. LLMì´ ì ì ˆí•œ í•¨ìˆ˜ë¥¼ ì„ íƒí•˜ëŠ” ê³¼ì • ê´€ì°°
3. ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš° í…ŒìŠ¤íŠ¸

### ë‹¨ê³„ 3: Function Calling vs ì¼ë°˜ í˜¸ì¶œ ë¹„êµ
1. `/api/function-call/normal` ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
2. `/api/function-call/calculator`ì™€ ë¹„êµ
3. Function Callingì˜ ì¥ì  ì´í•´

### ë‹¨ê³„ 4: ì½”ë“œ ë¶„ì„
1. `FunctionConfiguration.kt` í™•ì¸ - í•¨ìˆ˜ ì •ì˜ ë°©ë²•
2. `FunctionCallService.kt` í™•ì¸ - í•¨ìˆ˜ ë“±ë¡ ë° ì‚¬ìš© ë°©ë²•
3. `FunctionCallController.kt` í™•ì¸ - API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

---

## ğŸ“š ë‹¤ìŒ ë‹¨ê³„

ì´ ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í–ˆë‹¤ë©´:

1. âœ… Function Callingì˜ ê¸°ë³¸ ê°œë…ì„ ì´í•´í–ˆìŠµë‹ˆë‹¤
2. âœ… í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³  ë“±ë¡í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤
3. âœ… LLMì´ í•¨ìˆ˜ë¥¼ ì„ íƒí•˜ê³  í˜¸ì¶œí•˜ëŠ” ê³¼ì •ì„ ì´í•´í–ˆìŠµë‹ˆë‹¤
4. âœ… ë‹¤ìŒ ì¥ìœ¼ë¡œ ì§„í–‰í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!

**ë‹¤ìŒ í•™ìŠµ**: [9.2: Function Callingì„ í†µí•œ ì™¸ë¶€ API ì—°ë™](../../README.md#92-function-callingì„-í†µí•œ-ì™¸ë¶€-api-ì—°ë™)

---

## ğŸ’¡ ì¶”ê°€ í•™ìŠµ ìë£Œ

- [Spring AI Function Calling ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-ai/reference/api/function-calling.html)
- [OpenAI Function Calling ê°€ì´ë“œ](https://platform.openai.com/docs/guides/function-calling)

