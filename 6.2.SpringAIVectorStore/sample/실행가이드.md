# Spring AI VectorStore ì¶”ìƒí™” (In-Memory) ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” 6.2.RAG-Basic ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

- JDK 17 ì´ìƒ ì„¤ì¹˜
- OpenAI API Key ë°œê¸‰
- í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê¶Œí•œ

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í„°ë¯¸ë„ì—ì„œ API Keyë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •:

**macOS / Linux:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
```

### 2. í”„ë¡œì íŠ¸ ì‹¤í–‰

```bash
./gradlew bootRun
```

ë˜ëŠ” IntelliJ IDEAì—ì„œ `VectorStoreApplication.kt` ì‹¤í–‰

### 3. ì‹¤í–‰ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤:

```
Started VectorStoreApplication in X.XXX seconds
```

## ğŸ§ª API í…ŒìŠ¤íŠ¸

### ê¸°ë³¸ ë¬¸ì„œ ê´€ë¦¬

#### 1. ë¬¸ì„œ ì¶”ê°€

```bash
curl -X POST http://localhost:8080/api/documents/add \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Spring AIëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.",
    "metadata": {"category": "framework"}
  }'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "status": "success",
  "message": "ë¬¸ì„œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "documentId": "auto-generated",
  "text": "Spring AIëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.",
  "metadata": {
    "category": "framework"
  }
}
```

#### 2. ì—¬ëŸ¬ ë¬¸ì„œ ì¶”ê°€

```bash
curl -X POST http://localhost:8080/api/documents/batch/add \
  -H "Content-Type: application/json" \
  -d '{
    "texts": [
      "ì½”ë”©ì€ í”„ë¡œê·¸ë˜ë°ì˜ ì¼ë¶€ì…ë‹ˆë‹¤.",
      "ê°œë°œì€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§Œë“œëŠ” ê³¼ì •ì…ë‹ˆë‹¤.",
      "ìš”ë¦¬ëŠ” ìŒì‹ì„ ë§Œë“œëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤."
    ],
    "source": "manual"
  }'
```

#### 3. ìœ ì‚¬ë„ ê²€ìƒ‰ (POST)

```bash
curl -X POST http://localhost:8080/api/documents/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "í”„ë¡œê·¸ë˜ë°",
    "topK": 5
  }'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "query": "í”„ë¡œê·¸ë˜ë°",
  "topK": 5,
  "resultCount": 2,
  "results": [
    {
      "rank": 1,
      "content": "ì½”ë”©ì€ í”„ë¡œê·¸ë˜ë°ì˜ ì¼ë¶€ì…ë‹ˆë‹¤.",
      "metadata": {
        "index": 0,
        "source": "manual",
        "addedAt": 1234567890
      },
      "id": "unknown"
    },
    {
      "rank": 2,
      "content": "ê°œë°œì€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§Œë“œëŠ” ê³¼ì •ì…ë‹ˆë‹¤.",
      "metadata": {
        "index": 1,
        "source": "manual",
        "addedAt": 1234567890
      },
      "id": "unknown"
    }
  ]
}
```

#### 4. ìœ ì‚¬ë„ ê²€ìƒ‰ (GET)

```bash
curl "http://localhost:8080/api/documents/search?query=í”„ë¡œê·¸ë˜ë°&topK=5"
```

### ì„œë¹„ìŠ¤ ê¸°ë°˜ ì‚¬ìš©

#### 5. ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ë¬¸ì„œ ì¶”ê°€

```bash
curl -X POST http://localhost:8080/api/service/document/add \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Kotlinì€ JVM ì–¸ì–´ì…ë‹ˆë‹¤.",
    "metadata": {"category": "programming", "language": "kotlin"}
  }'
```

#### 6. ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ê²€ìƒ‰

```bash
curl -X POST http://localhost:8080/api/service/document/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "í”„ë¡œê·¸ë˜ë° ì–¸ì–´",
    "topK": 3
  }'
```

#### 7. ë©”íƒ€ë°ì´í„° í•„í„°ë§ ê²€ìƒ‰

```bash
curl -X POST http://localhost:8080/api/service/document/search-with-filter \
  -H "Content-Type: application/json" \
  -d '{
    "query": "í”„ë¡œê·¸ë˜ë°",
    "topK": 5,
    "category": "programming"
  }'
```

#### 8. ë¬¸ì„œ í†µê³„ ì¡°íšŒ

```bash
curl http://localhost:8080/api/service/document/stats
```

### ì§€ì‹ë² ì´ìŠ¤ ì‹œìŠ¤í…œ

#### 9. ì§€ì‹ ì¶”ê°€

```bash
curl -X POST http://localhost:8080/api/service/knowledge/add \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Spring AI ì†Œê°œ",
    "content": "Spring AIëŠ” Spring í”„ë ˆì„ì›Œí¬ë¥¼ ìœ„í•œ AI í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.",
    "topic": "spring"
  }'
```

#### 10. ì§€ì‹ ê²€ìƒ‰

```bash
curl -X POST http://localhost:8080/api/service/knowledge/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Spring AI",
    "topic": "spring",
    "topK": 3
  }'
```

### FAQ ì‹œìŠ¤í…œ

#### 11. FAQ ì¶”ê°€

```bash
curl -X POST http://localhost:8080/api/service/faq/add \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Spring AIëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
    "answer": "Spring AIëŠ” Spring í”„ë ˆì„ì›Œí¬ë¥¼ ìœ„í•œ AI í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.",
    "category": "general"
  }'
```

#### 12. FAQ ê²€ìƒ‰

```bash
curl -X POST http://localhost:8080/api/service/faq/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Spring AI",
    "category": "general",
    "topK": 3
  }'
```

## ğŸ” ë””ë²„ê¹…

### ë¡œê·¸ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì—¬ ë””ë²„ê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
# application.ymlì— ì´ë¯¸ ì„¤ì •ë¨
logging:
  level:
    com.example.springai: DEBUG
    org.springframework.ai: DEBUG
```

## âŒ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: SimpleVectorStore ë°ì´í„° ì†ì‹¤

**ì¦ìƒ:**
```
ì„œë²„ ì¬ì‹œì‘ í›„ ë°ì´í„°ê°€ ì‚¬ë¼ì§
```

**ì›ì¸**: SimpleVectorStoreëŠ” ë©”ëª¨ë¦¬ ê¸°ë°˜

**í•´ê²°ì±…:**
- í”„ë¡œë•ì…˜ì—ì„œëŠ” PGVector ë“± ì˜êµ¬ ì €ì¥ì†Œ ì‚¬ìš©
- ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì •ê¸°ì ìœ¼ë¡œ ë°±ì—…

### ë¬¸ì œ 2: ê²€ìƒ‰ ê²°ê³¼ê°€ ë¹„ì–´ìˆìŒ

**ì¦ìƒ:**
```
ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ë³´ëƒˆì§€ë§Œ ê²°ê³¼ê°€ ì—†ìŒ
```

**í•´ê²°ì±…:**
1. ë¬¸ì„œê°€ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
2. ì¿¼ë¦¬ í…ìŠ¤íŠ¸ í™•ì¸
3. ì„ë² ë”© ëª¨ë¸ í™•ì¸
4. ë¡œê·¸ í™•ì¸

### ë¬¸ì œ 3: ë©”íƒ€ë°ì´í„° ì ‘ê·¼ ì˜¤ë¥˜

**ì¦ìƒ:**
```
ClassCastException: String cannot be cast to Integer
```

**ì›ì¸**: ë©”íƒ€ë°ì´í„° íƒ€ì… ë¶ˆì¼ì¹˜

**í•´ê²°ì±…:**
```kotlin
// ì•ˆì „í•œ ë©”íƒ€ë°ì´í„° ì ‘ê·¼
val category = doc.metadata["category"] as? String ?: "unknown"
val year = (doc.metadata["year"] as? Number)?.toInt() ?: 0
```

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‹¤í–‰ ì „ í™•ì¸ì‚¬í•­:

- [ ] JDK 17 ì´ìƒ ì„¤ì¹˜ë¨
- [ ] OpenAI API Key ë°œê¸‰ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ë¨
- [ ] í”„ë¡œì íŠ¸ ë¹Œë“œ ì„±ê³µ (`./gradlew build`)
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì„±ê³µ (`./gradlew bootRun`)
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

## ğŸ“ í•™ìŠµ ê¶Œì¥ ìˆœì„œ

1. **ê¸°ë³¸ ë¬¸ì„œ ì¶”ê°€**: `/api/documents/add`
2. **ìœ ì‚¬ë„ ê²€ìƒ‰**: `/api/documents/search`
3. **ë°°ì¹˜ ë¬¸ì„œ ì¶”ê°€**: `/api/documents/batch/add`
4. **ì„œë¹„ìŠ¤ ê¸°ë°˜ ì‚¬ìš©**: `/api/service/document/*`
5. **ì§€ì‹ë² ì´ìŠ¤**: `/api/service/knowledge/*`
6. **FAQ ì‹œìŠ¤í…œ**: `/api/service/faq/*`
7. **ì½”ë“œ ë¶„ì„**: VectorStoreConfig, DocumentService í™•ì¸

## ğŸ“š í•µì‹¬ ê°œë… ì •ë¦¬

### VectorStore ì„¤ì • íŒ¨í„´

```kotlin
@Configuration
class VectorStoreConfig(
    private val embeddingModel: EmbeddingModel
) {
    @Bean
    fun vectorStore(): VectorStore {
        return SimpleVectorStore.builder(embeddingModel).build()
    }
}
```

### ë¬¸ì„œ ì¶”ê°€ íŒ¨í„´

```kotlin
val document = Document("ë¬¸ì„œ ë‚´ìš©", metadata)
vectorStore.add(listOf(document))
```

### ìœ ì‚¬ë„ ê²€ìƒ‰ íŒ¨í„´

```kotlin
val results = vectorStore.similaritySearch(query) ?: emptyList()
val limitedResults = results.take(topK)
```

### ë©”íƒ€ë°ì´í„° í•„í„°ë§ íŒ¨í„´

```kotlin
val results = vectorStore.similaritySearch(query) ?: emptyList()
val filtered = results.filter { doc ->
    doc.metadata["category"] == targetCategory
}
val limited = filtered.take(topK)
```

### Document ì ‘ê·¼

```kotlin
// Documentì˜ ë‚´ìš©ì€ text ì†ì„±ìœ¼ë¡œ ì ‘ê·¼
doc.text        // ë¬¸ì„œ ë‚´ìš©
doc.metadata   // ë©”íƒ€ë°ì´í„°
doc.id         // ë¬¸ì„œ ID (nullable)
```

---

**ë‹¤ìŒ í•™ìŠµ**: [6.3: ì™¸ë¶€ ë²¡í„° ì €ì¥ì†Œ ì—°ë™ (PostgreSQL/PGVector)](../../README.md#63-ì™¸ë¶€-ë²¡í„°-ì €ì¥ì†Œ-ì—°ë™-postgresqlpgvector)

