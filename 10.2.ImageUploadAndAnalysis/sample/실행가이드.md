# ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„ ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³  Spring AIë¥¼ í†µí•´ ë¶„ì„í•˜ëŠ” ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### ê¸°ë³¸ ì¤€ë¹„
- JDK 17 ì´ìƒ
- Gradle ì„¤ì¹˜ (ë˜ëŠ” Gradle Wrapper ì‚¬ìš©)

### LLM ì¤€ë¹„ì‚¬í•­

#### OpenAI ì‚¬ìš© ì‹œ (ê¶Œì¥ - Vision ì™„ì „ ì§€ì›)
- OpenAI API Key ë°œê¸‰: https://platform.openai.com/
- Visionì„ ì§€ì›í•˜ëŠ” ëª¨ë¸ ì‚¬ìš© (GPT-4o, GPT-4 Turbo)

> âš ï¸ **ì¤‘ìš”**: Vision APIë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ **GPT-4o** ë˜ëŠ” **GPT-4 Turbo** ê°™ì€ Vision ì§€ì› ëª¨ë¸ì´ í•„ìš”í•©ë‹ˆë‹¤. GPT-3.5-turboëŠ” Visionì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### Anthropic Claude 3 ì‚¬ìš© ì‹œ
- Anthropic API Key ë°œê¸‰: https://console.anthropic.com/
- Claude 3 ëª¨ë¸ ì‚¬ìš© (Vision ì§€ì›)

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ì‹œë‚˜ë¦¬ì˜¤ 1: OpenAI GPT-4o ì‚¬ìš© (ê¶Œì¥)

#### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

#### 2. application.yml í™•ì¸

```yaml
spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      chat:
        options:
          model: gpt-4o          # Vision ì§€ì› ëª¨ë¸
          temperature: 0.7
          max-tokens: 1000
```

#### 3. í”„ë¡œì íŠ¸ ì‹¤í–‰

```bash
cd sample
./gradlew bootRun
```

#### 4. í…ŒìŠ¤íŠ¸

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ë©´ ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
# ìƒíƒœ í™•ì¸
curl http://localhost:9000/api/image/test

# ì§€ì›í•˜ëŠ” íŒŒì¼ í˜•ì‹ í™•ì¸
curl http://localhost:9000/api/image/info

# ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„ (ì´ë¯¸ì§€ íŒŒì¼ í•„ìš”)
curl -X POST http://localhost:9000/api/image/upload-and-analyze \
  -F "file=@/path/to/your/image.jpg" \
  -F "question=ì´ ì´ë¯¸ì§€ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”"
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: Anthropic Claude 3 ì‚¬ìš©

#### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
export ANTHROPIC_API_KEY="sk-ant-your-api-key-here"
```

#### 2. build.gradle.kts ìˆ˜ì •

```kotlin
dependencies {
    // Anthropic ì˜ì¡´ì„± ì£¼ì„ í•´ì œ
    implementation("org.springframework.ai:spring-ai-anthropic-spring-boot-starter:1.0.0-M6")
    
    // OpenAI ì˜ì¡´ì„± ì£¼ì„ ì²˜ë¦¬
    // implementation("org.springframework.ai:spring-ai-openai-spring-boot-starter:1.0.0-M6")
}
```

#### 3. application.yml ìˆ˜ì •

```yaml
spring:
  ai:
    anthropic:
      api-key: ${ANTHROPIC_API_KEY}
      chat:
        options:
          model: claude-3-opus-20240229  # Vision ì§€ì› ëª¨ë¸
          temperature: 0.7
          max-tokens: 1000
```

#### 4. í”„ë¡œì íŠ¸ ì¬ë¹Œë“œ ë° ì‹¤í–‰

```bash
./gradlew clean build
./gradlew bootRun
```

---

## ğŸ§ª API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸

### 1. ìƒíƒœ í™•ì¸

#### GET /api/image/test

```bash
curl http://localhost:9000/api/image/test
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "status": "OK",
  "message": "Image Upload and Analysis API is running",
  "endpoints": "...",
  "note": "Vision APIë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ GPT-4o ë˜ëŠ” Claude 3 ë“± Vision ì§€ì› ëª¨ë¸ì´ í•„ìš”í•©ë‹ˆë‹¤."
}
```

### 2. ì§€ì›í•˜ëŠ” íŒŒì¼ í˜•ì‹ í™•ì¸

#### GET /api/image/info

```bash
curl http://localhost:9000/api/image/info
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "supportedFormats": ["image/png", "image/jpeg", "image/jpg", "image/gif", "image/webp"],
  "maxFileSizeMB": 20,
  "note": "PNG, JPEG, GIF, WebP í˜•ì‹ì˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
}
```

### 3. ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„

#### POST /api/image/upload-and-analyze

```bash
curl -X POST http://localhost:9000/api/image/upload-and-analyze \
  -F "file=@/path/to/image.jpg" \
  -F "question=ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”"
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "success": true,
  "filename": "image.jpg",
  "size": 123456,
  "contentType": "image/jpeg",
  "question": "ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”",
  "analysis": "ì´ ì´ë¯¸ì§€ëŠ”..."
}
```

**ë‹¤ë¥¸ ì˜ˆì œ:**
```bash
# ì§ˆë¬¸ ì—†ì´ ê¸°ë³¸ ë¶„ì„
curl -X POST http://localhost:9000/api/image/upload-and-analyze \
  -F "file=@/path/to/image.jpg"

# íŠ¹ì • ì§ˆë¬¸ê³¼ í•¨ê»˜
curl -X POST http://localhost:9000/api/image/upload-and-analyze \
  -F "file=@/path/to/image.jpg" \
  -F "question=ì´ ì´ë¯¸ì§€ì— ìˆëŠ” ì‚¬ëŒì€ ëª‡ ëª…ì¸ê°€ìš”?"
```

### 4. ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ì„¤ëª… ìƒì„±

#### POST /api/image/upload-and-describe

```bash
curl -X POST http://localhost:9000/api/image/upload-and-describe \
  -F "file=@/path/to/image.jpg"
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "success": true,
  "filename": "image.jpg",
  "size": 123456,
  "contentType": "image/jpeg",
  "description": "ì´ ì´ë¯¸ì§€ëŠ”..."
}
```

### 5. ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ì§ˆë¬¸ ë‹µë³€

#### POST /api/image/upload-and-ask

```bash
curl -X POST http://localhost:9000/api/image/upload-and-ask \
  -F "file=@/path/to/image.jpg" \
  -F "question=ì´ ì´ë¯¸ì§€ì— ìˆëŠ” ì£¼ìš” ìƒ‰ìƒì€ ë¬´ì—‡ì¸ê°€ìš”?"
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "success": true,
  "filename": "image.jpg",
  "size": 123456,
  "question": "ì´ ì´ë¯¸ì§€ì— ìˆëŠ” ì£¼ìš” ìƒ‰ìƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
  "answer": "ì´ ì´ë¯¸ì§€ì˜ ì£¼ìš” ìƒ‰ìƒì€..."
}
```

### 6. ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ìƒì„¸ ë¶„ì„

#### POST /api/image/upload-and-analyze-details

```bash
curl -X POST http://localhost:9000/api/image/upload-and-analyze-details \
  -F "file=@/path/to/image.jpg"
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "success": true,
  "filename": "image.jpg",
  "size": 123456,
  "contentType": "image/jpeg",
  "analysis": "1. ì£¼ìš” ê°ì²´ë“¤: ...\n2. ì£¼ìš” ìƒ‰ìƒ: ...\n3. ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼: ..."
}
```

---

## ğŸ“Š Postman Collection

Postmanì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

### Request 1: ìƒíƒœ í™•ì¸
- Method: GET
- URL: `http://localhost:9000/api/image/test`

### Request 2: íŒŒì¼ í˜•ì‹ ì •ë³´
- Method: GET
- URL: `http://localhost:9000/api/image/info`

### Request 3: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„
- Method: POST
- URL: `http://localhost:9000/api/image/upload-and-analyze`
- Body: form-data
  - `file`: (File) ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ
  - `question`: (Text) "ì´ ì´ë¯¸ì§€ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”"

### Request 4: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ì„¤ëª…
- Method: POST
- URL: `http://localhost:9000/api/image/upload-and-describe`
- Body: form-data
  - `file`: (File) ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ

---

## ğŸ” í™•ì¸ ì‚¬í•­

### OpenAI í™•ì¸

```bash
# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
echo $OPENAI_API_KEY

# API í…ŒìŠ¤íŠ¸
curl http://localhost:9000/api/image/test
```

### Anthropic í™•ì¸

```bash
# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
echo $ANTHROPIC_API_KEY

# API í…ŒìŠ¤íŠ¸
curl http://localhost:9000/api/image/test
```

---

## âŒ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨

**ì¦ìƒ**: 
```
File too large
```

**ì›ì¸**: íŒŒì¼ í¬ê¸°ê°€ 20MBë¥¼ ì´ˆê³¼

**í•´ê²°ì±…**:
- ì´ë¯¸ì§€ í¬ê¸° í™•ì¸
- application.ymlì—ì„œ íŒŒì¼ í¬ê¸° ì œí•œ í™•ì¸
- í•„ìš”ì‹œ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ

### ë¬¸ì œ 2: ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹

**ì¦ìƒ**:
```
ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤
```

**ì›ì¸**: PNG, JPEG, GIF, WebPê°€ ì•„ë‹Œ í˜•ì‹

**í•´ê²°ì±…**:
- ì§€ì›í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë³€í™˜
- `/api/image/info`ë¡œ ì§€ì› í˜•ì‹ í™•ì¸

### ë¬¸ì œ 3: Vision APIê°€ ì‘ë™í•˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì§€ ëª»í•¨

**ì›ì¸**:
- Visionì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ëª¨ë¸ ì‚¬ìš© (ì˜ˆ: GPT-3.5-turbo)
- Spring AI 1.0.0-M6ì—ì„œ Vision APIê°€ ì™„ì „íˆ ì§€ì›ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

**í•´ê²°ì±…**:
- GPT-4o ë˜ëŠ” GPT-4 Turbo ì‚¬ìš©
- Claude 3 ì‚¬ìš©
- ëª¨ë¸ë³„ Vision API ë¬¸ì„œ í™•ì¸

### ë¬¸ì œ 4: OpenAI API Key ì˜¤ë¥˜

**ì¦ìƒ**:
```
Invalid API Key
```

**í•´ê²°ì±…**:
```bash
# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
echo $OPENAI_API_KEY

# ì˜¬ë°”ë¥¸ í‚¤ ì„¤ì •
export OPENAI_API_KEY="sk-..."
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‹¤í–‰ ì „ í™•ì¸:

### ê¸°ë³¸
- [ ] JDK 17 ì´ìƒ ì„¤ì¹˜ë¨
- [ ] í”„ë¡œì íŠ¸ ë¹Œë“œ ì„±ê³µ (`./gradlew build`)
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì„±ê³µ

### OpenAI ì‚¬ìš© ì‹œ
- [ ] OpenAI API Key ë°œê¸‰ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ë¨ (`export OPENAI_API_KEY`)
- [ ] GPT-4o ë˜ëŠ” GPT-4 Turbo ëª¨ë¸ ì‚¬ìš©
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

### Anthropic ì‚¬ìš© ì‹œ
- [ ] Anthropic API Key ë°œê¸‰ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ë¨ (`export ANTHROPIC_API_KEY`)
- [ ] Claude 3 ëª¨ë¸ ì‚¬ìš©
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

### ì´ë¯¸ì§€ íŒŒì¼
- [ ] í…ŒìŠ¤íŠ¸ìš© ì´ë¯¸ì§€ íŒŒì¼ ì¤€ë¹„ (PNG, JPEG, GIF, WebP)
- [ ] ì´ë¯¸ì§€ í¬ê¸°ê°€ 20MB ì´í•˜ì¸ì§€ í™•ì¸

---

## ğŸ“ í•™ìŠµ ì‹œë‚˜ë¦¬ì˜¤

### ë‹¨ê³„ 1: ê¸°ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ
1. `/api/image/test` ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
2. `/api/image/info` ì—”ë“œí¬ì¸íŠ¸ë¡œ ì§€ì› í˜•ì‹ í™•ì¸
3. ê°„ë‹¨í•œ ì´ë¯¸ì§€ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸

### ë‹¨ê³„ 2: ì´ë¯¸ì§€ ë¶„ì„
1. `/api/image/upload-and-analyze` ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
2. ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„ ê²°ê³¼ í™•ì¸
3. ë‹¤ì–‘í•œ ì§ˆë¬¸ìœ¼ë¡œ í…ŒìŠ¤íŠ¸

### ë‹¨ê³„ 3: ë‹¤ì–‘í•œ ë¶„ì„ ê¸°ëŠ¥
1. `/api/image/upload-and-describe` í…ŒìŠ¤íŠ¸
2. `/api/image/upload-and-ask` í…ŒìŠ¤íŠ¸
3. `/api/image/upload-and-analyze-details` í…ŒìŠ¤íŠ¸

### ë‹¨ê³„ 4: ì½”ë“œ ë¶„ì„
1. `ImageValidationService.kt` í™•ì¸ - íŒŒì¼ ê²€ì¦ ë¡œì§
2. `ImageAnalysisService.kt` í™•ì¸ - ì´ë¯¸ì§€ ë¶„ì„ ë¡œì§
3. `ImageUploadController.kt` í™•ì¸ - API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
4. MultipartFileê³¼ Base64 ì¸ì½”ë”© ë°©ì‹ ì´í•´

---

## ğŸ“š ë‹¤ìŒ ë‹¨ê³„

ì´ ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í–ˆë‹¤ë©´:

1. âœ… MultipartFileì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²•ì„ ì´í•´í–ˆìŠµë‹ˆë‹¤
2. âœ… Base64 ì¸ì½”ë”©ì„ í†µí•´ ì´ë¯¸ì§€ë¥¼ Spring AIì— ì „ì†¡í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤
3. âœ… íŒŒì¼ ê²€ì¦ ë° ì—ëŸ¬ ì²˜ë¦¬ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤
4. âœ… ì™„ì „í•œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„ APIë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤
5. âœ… ë‹¤ìŒ ì¥ìœ¼ë¡œ ì§„í–‰í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!

**ë‹¤ìŒ í•™ìŠµ**: [11ì¥: [ì‹¤ì „] ê°„ë‹¨í•œ Q&A ì±—ë´‡ API êµ¬í˜„](../../README.md#11ì¥-ì‹¤ì „-ê°„ë‹¨í•œ-qa-ì±—ë´‡-api-êµ¬í˜„)

---

## ğŸ’¡ ì¶”ê°€ í•™ìŠµ ìë£Œ

- [Spring AI Multimodality ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-ai/reference/api/multimodal.html)
- [Spring MultipartFile ê°€ì´ë“œ](https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-methods/multipart.html)
- [OpenAI Vision API ê°€ì´ë“œ](https://platform.openai.com/docs/guides/vision)

