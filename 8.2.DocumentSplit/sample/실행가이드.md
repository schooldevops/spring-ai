# ë¬¸ì„œ ë¶„í•  (Document Transformers) ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” 8.2.DocumentSplit ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

- JDK 17 ì´ìƒ ì„¤ì¹˜
- OpenAI API Key ë°œê¸‰
- í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê¶Œí•œ

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

**macOS / Linux:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
```

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

```bash
./gradlew bootRun
```

ë˜ëŠ” IntelliJ IDEAì—ì„œ `DocumentSplitApplication.kt` ì‹¤í–‰

### 3. ì‹¤í–‰ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤:

```
Started DocumentSplitApplication in X.XXX seconds
```

## ğŸ§ª API í…ŒìŠ¤íŠ¸

### 1. í† í° ê¸°ë°˜ ë¶„í• 

```bash
curl -X POST http://localhost:8080/api/split/text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Spring AIëŠ” Spring ìƒíƒœê³„ì˜ ìµœì‹  í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ LLM ì œê³µìë¥¼ í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ChatModel, EmbeddingModel, VectorStore ë“±ì˜ ì¶”ìƒí™”ë¥¼ ì œê³µí•©ë‹ˆë‹¤. RAG íŒ¨í„´ì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ë„êµ¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
    "strategy": "TOKEN",
    "chunkSize": 50,
    "overlap": 10,
    "addToVectorStore": true
  }'
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "status": "success",
  "message": "ë¬¸ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë¶„í• ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "originalLength": 150,
  "chunkCount": 3,
  "strategy": "TOKEN",
  "chunks": [
    {
      "index": 0,
      "text": "Spring AIëŠ” Spring ìƒíƒœê³„ì˜ ìµœì‹  í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤...",
      "length": 50,
      "metadata": {
        "chunkIndex": 0,
        "totalChunks": 3
      }
    }
  ]
}
```

### 2. ë¬¸ì¥ ê¸°ë°˜ ë¶„í• 

```bash
curl -X POST http://localhost:8080/api/split/text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "ì²« ë²ˆì§¸ ë¬¸ì¥ì…ë‹ˆë‹¤. ë‘ ë²ˆì§¸ ë¬¸ì¥ì…ë‹ˆë‹¤. ì„¸ ë²ˆì§¸ ë¬¸ì¥ì…ë‹ˆë‹¤. ë„¤ ë²ˆì§¸ ë¬¸ì¥ì…ë‹ˆë‹¤. ë‹¤ì„¯ ë²ˆì§¸ ë¬¸ì¥ì…ë‹ˆë‹¤.",
    "strategy": "SENTENCE",
    "chunkSize": 100,
    "addToVectorStore": true
  }'
```

### 3. ë‹¨ë½ ê¸°ë°˜ ë¶„í• 

```bash
curl -X POST http://localhost:8080/api/split/text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "ì²« ë²ˆì§¸ ë‹¨ë½ì…ë‹ˆë‹¤.\n\në‘ ë²ˆì§¸ ë‹¨ë½ì…ë‹ˆë‹¤.\n\nì„¸ ë²ˆì§¸ ë‹¨ë½ì…ë‹ˆë‹¤.",
    "strategy": "PARAGRAPH",
    "chunkSize": 200,
    "addToVectorStore": true
  }'
```

### 4. Overlap í…ŒìŠ¤íŠ¸

```bash
curl -X POST http://localhost:8080/api/split/text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "ì´ê²ƒì€ ë§¤ìš° ê¸´ ë¬¸ì„œì…ë‹ˆë‹¤. ì—¬ëŸ¬ ë¬¸ì¥ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê° ë¬¸ì¥ì€ ì˜ë¯¸ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë¬¸ì„œë¥¼ ë¶„í• í•˜ë©´ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Overlapì„ ì‚¬ìš©í•˜ë©´ ë¬¸ë§¥ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    "strategy": "TOKEN",
    "chunkSize": 50,
    "overlap": 20,
    "addToVectorStore": false
  }'
```

### 5. ë‹¤ì–‘í•œ ì²­í¬ í¬ê¸° í…ŒìŠ¤íŠ¸

```bash
# ì‘ì€ ì²­í¬
curl -X POST http://localhost:8080/api/split/text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "ê¸´ ë¬¸ì„œ ë‚´ìš©...",
    "strategy": "TOKEN",
    "chunkSize": 200,
    "overlap": 20
  }'

# ì¤‘ê°„ ì²­í¬
curl -X POST http://localhost:8080/api/split/text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "ê¸´ ë¬¸ì„œ ë‚´ìš©...",
    "strategy": "TOKEN",
    "chunkSize": 500,
    "overlap": 50
  }'

# í° ì²­í¬
curl -X POST http://localhost:8080/api/split/text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "ê¸´ ë¬¸ì„œ ë‚´ìš©...",
    "strategy": "TOKEN",
    "chunkSize": 1000,
    "overlap": 100
  }'
```

## ğŸ” ë¬¸ì„œ ë¶„í•  ë™ì‘ í™•ì¸

### ë¶„í•  í”„ë¡œì„¸ìŠ¤

1. **ë¬¸ì„œ ì…ë ¥**: ê¸´ í…ìŠ¤íŠ¸ ë˜ëŠ” Document ê°ì²´
2. **ì „ëµ ì„ íƒ**: TOKEN, SENTENCE, PARAGRAPH
3. **íŒŒë¼ë¯¸í„° ì„¤ì •**: chunkSize, overlap
4. **ë¶„í•  ì‹¤í–‰**: ì„ íƒëœ ì „ëµìœ¼ë¡œ ë¶„í• 
5. **ë©”íƒ€ë°ì´í„° ì¶”ê°€**: ì²­í¬ ì •ë³´ ì¶”ê°€
6. **VectorStore ì¶”ê°€**: ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸° (ì„ íƒ)

### Overlap í™•ì¸

Overlapì´ ìˆëŠ” ê²½ìš°, ì¸ì ‘í•œ ì²­í¬ë“¤ì´ ì¼ë¶€ ë‚´ìš©ì„ ê³µìœ í•©ë‹ˆë‹¤:

```
ì²­í¬ 1: "Spring AIëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ LLMì„ ì§€ì›í•©ë‹ˆë‹¤."
ì²­í¬ 2: "ë‹¤ì–‘í•œ LLMì„ ì§€ì›í•©ë‹ˆë‹¤. ì„ë² ë”© ëª¨ë¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤."
```

â†’ "ë‹¤ì–‘í•œ LLMì„ ì§€ì›í•©ë‹ˆë‹¤"ê°€ ê²¹ì³ì„œ ë¬¸ë§¥ì´ ìœ ì§€ë¨

## ğŸ’¡ í•™ìŠµ í™•ì¸

ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ë³´ì„¸ìš”:

1. **í† í° ê¸°ë°˜ ë¶„í• **
   - ê³ ì • í¬ê¸°ë¡œ ë¶„í•  í™•ì¸
   - Overlap ë™ì‘ í™•ì¸

2. **ë¬¸ì¥ ê¸°ë°˜ ë¶„í• **
   - ë¬¸ì¥ ë‹¨ìœ„ë¡œ ë¶„í•  í™•ì¸
   - ì˜ë¯¸ ë³´ì¡´ í™•ì¸

3. **ë‹¨ë½ ê¸°ë°˜ ë¶„í• **
   - ë‹¨ë½ ë‹¨ìœ„ë¡œ ë¶„í•  í™•ì¸
   - ë…¼ë¦¬ì  êµ¬ì¡° ë³´ì¡´ í™•ì¸

4. **Overlap íš¨ê³¼**
   - ë¬¸ë§¥ ìœ ì§€ í™•ì¸
   - ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ í™•ì¸

5. **íŒŒë¼ë¯¸í„° ìµœì í™”**
   - ì²­í¬ í¬ê¸° ì¡°ì • íš¨ê³¼ í™•ì¸
   - Overlap í¬ê¸° ì¡°ì • íš¨ê³¼ í™•ì¸

## âŒ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: ì²­í¬ê°€ ë„ˆë¬´ ì‘ìŒ

**ì¦ìƒ:**
```
ì²­í¬ ìˆ˜ê°€ ë„ˆë¬´ ë§ìŒ
```

**í•´ê²°ì±…:**
1. chunkSize ê°’ ì¦ê°€
2. ë” í° ì²­í¬ í¬ê¸° ì‚¬ìš© (500-1000)

### ë¬¸ì œ 2: ì²­í¬ê°€ ë„ˆë¬´ í¼

**ì¦ìƒ:**
```
ì²­í¬ ìˆ˜ê°€ ë„ˆë¬´ ì ìŒ
```

**í•´ê²°ì±…:**
1. chunkSize ê°’ ê°ì†Œ
2. ë” ì‘ì€ ì²­í¬ í¬ê¸° ì‚¬ìš© (200-500)

### ë¬¸ì œ 3: ë¬¸ë§¥ ì†ì‹¤

**ì¦ìƒ:**
```
ì¸ì ‘í•œ ì²­í¬ ê°„ ì—°ê²°ì´ ëŠê¹€
```

**í•´ê²°ì±…:**
1. overlap ê°’ ì¦ê°€
2. ë¬¸ì¥ ê¸°ë°˜ ë˜ëŠ” ë‹¨ë½ ê¸°ë°˜ ì „ëµ ì‚¬ìš©

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‹¤í–‰ ì „ í™•ì¸ì‚¬í•­:

- [ ] JDK 17 ì´ìƒ ì„¤ì¹˜ë¨
- [ ] OpenAI API Key ë°œê¸‰ë¨
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ë¨
- [ ] í”„ë¡œì íŠ¸ ë¹Œë“œ ì„±ê³µ (`./gradlew build`)
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì„±ê³µ (`./gradlew bootRun`)
- [ ] í…ìŠ¤íŠ¸ ë¶„í•  ì„±ê³µ (`POST /api/split/text`)

## ğŸ“ í•™ìŠµ ê¶Œì¥ ìˆœì„œ

1. **í† í° ê¸°ë°˜ ë¶„í• **: `POST /api/split/text` (strategy: TOKEN)
2. **ë¬¸ì¥ ê¸°ë°˜ ë¶„í• **: `POST /api/split/text` (strategy: SENTENCE)
3. **ë‹¨ë½ ê¸°ë°˜ ë¶„í• **: `POST /api/split/text` (strategy: PARAGRAPH)
4. **Overlap í…ŒìŠ¤íŠ¸**: overlap ê°’ ì¡°ì •í•˜ì—¬ í…ŒìŠ¤íŠ¸
5. **íŒŒë¼ë¯¸í„° ìµœì í™”**: chunkSizeì™€ overlap ì¡°ì •
6. **ì½”ë“œ ë¶„ì„**: TokenTextSplitter.kt, DocumentSplitService.kt í™•ì¸

## ğŸ“š í•µì‹¬ ê°œë… ì •ë¦¬

### ë¬¸ì„œ ë¶„í•  íŒ¨í„´

```kotlin
// 1. Splitter ìƒì„±
val splitter = TokenTextSplitter(
    chunkSize = 500,
    chunkOverlap = 50
)

// 2. ë¬¸ì„œ ë¶„í• 
val chunks = splitter.apply(document)

// 3. ë©”íƒ€ë°ì´í„° ì¶”ê°€
val chunksWithMetadata = chunks.mapIndexed { index, chunk ->
    Document(
        chunk.text ?: "",
        document.metadata + chunk.metadata + mapOf(
            "chunkIndex" to index,
            "totalChunks" to chunks.size
        )
    )
}

// 4. VectorStoreì— ì¶”ê°€
vectorStore.add(chunksWithMetadata)
```

### ë¶„í•  ì „ëµ ì„ íƒ

```kotlin
when (strategy) {
    SplitStrategy.TOKEN -> splitByToken(document, chunkSize, overlap)
    SplitStrategy.SENTENCE -> splitBySentence(document, chunkSize)
    SplitStrategy.PARAGRAPH -> splitByParagraph(document, chunkSize)
}
```

### Overlap ì„¤ì •

```kotlin
// ì‘ì€ Overlap (ë¹ ë¥´ì§€ë§Œ ë¬¸ë§¥ ì†ì‹¤ ê°€ëŠ¥)
val splitter = TokenTextSplitter(chunkSize = 500, chunkOverlap = 0)

// ê¶Œì¥ Overlap (ê· í˜•ì¡íŒ ì„ íƒ)
val splitter = TokenTextSplitter(chunkSize = 500, chunkOverlap = 50)

// í° Overlap (ê°•í•œ ë¬¸ë§¥ ìœ ì§€)
val splitter = TokenTextSplitter(chunkSize = 500, chunkOverlap = 100)
```

---

**ë‹¤ìŒ í•™ìŠµ**: [9.1: Function Calling ê°œë…ê³¼ í™œìš©](../../README.md#91-function-calling-ê°œë…ê³¼-í™œìš©)

